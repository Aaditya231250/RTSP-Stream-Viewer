import{r as e,a as t,R as s}from"./vendor-X31hiD63.js";import{c as r,X as a,A as n,L as o,P as l,a as c,M as i,W as d,b as u,d as m}from"./ui-HNb-zToB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var p={exports:{}},x={},h=e,f=Symbol.for("react.element"),g=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,b=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,s){var r,a={},n=null,o=null;for(r in void 0!==s&&(n=""+s),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(o=t.ref),t)y.call(t,r)&&!v.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:f,type:e,key:n,ref:o,props:a,_owner:b.current}}x.Fragment=g,x.jsx=k,x.jsxs=k,p.exports=x;var j=p.exports,S={},N=t;S.createRoot=N.createRoot,S.hydrateRoot=N.hydrateRoot;const w=r((e,t)=>({streams:new Map,connectionStatus:"disconnected",addStream:(t,s,r)=>e(e=>{const a=new Map(e.streams);return a.set(t,{id:t,url:s,title:r,status:"connecting",chunks:[],lastUpdate:Date.now(),playing:!1}),{streams:a}}),updateStreamStatus:(t,s)=>e(e=>{const r=new Map(e.streams),a=r.get(t);return a&&r.set(t,{...a,status:s,lastUpdate:Date.now()}),{streams:r}}),addStreamChunk:(t,s)=>e(e=>{const r=new Map(e.streams),a=r.get(t);if(a){const e=[...a.chunks,s].slice(-10);r.set(t,{...a,chunks:e,lastUpdate:Date.now(),status:"active"})}return{streams:r}}),toggleStreamPlayback:t=>e(e=>{const s=new Map(e.streams),r=s.get(t);return r&&s.set(t,{...r,playing:!r.playing}),{streams:s}}),removeStream:t=>e(e=>{const s=new Map(e.streams);return s.delete(t),{streams:s}}),setConnectionStatus:t=>e({connectionStatus:t}),getStream:e=>t().streams.get(e),getActiveStreams:()=>Array.from(t().streams.values())})),_={};function L({streamId:t,onRemove:s}){const r=e.useRef(null),i=e.useRef(null),[d,u]=e.useState(!1),[m,p]=e.useState(null),[x,h]=e.useState(null),[f,g]=e.useState(!1),y=w(e=>e.getStream(t));e.useEffect(()=>{if(y&&y.chunks.length>0){const e=`${"https://rtsp-backend-88322650503.us-central1.run.app"}/api/hls/${t}/playlist.m3u8`;h(e),console.log(`üé¨ HLS URL: ${e}`)}},[null==y?void 0:y.chunks.length,t]),e.useEffect(()=>(x&&r.current&&function(e,t){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/your-repo-name/"+e}(e))in _)return;_[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})}(()=>import("./video-C5RQ_NaQ.js"),[]).then(e=>{var s;const a=e.default;if(a.isSupported()){console.log(`Initializing HLS for stream: ${t}`);const e=new a({debug:!1,enableWorker:!1,lowLatencyMode:!0,backBufferLength:5,maxBufferLength:15,maxMaxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,liveSyncDurationCount:2,liveMaxLatencyDurationCount:4,liveDurationInfinity:!0,fragLoadingTimeOut:1e4,fragLoadingMaxRetry:3,fragLoadingRetryDelay:1e3,manifestLoadingTimeOut:5e3,manifestLoadingMaxRetry:3,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:5e3,levelLoadingMaxRetry:2,levelLoadingRetryDelay:1e3,nudgeOffset:.1,nudgeMaxRetry:3,maxSeekHole:2,startFragPrefetch:!0});i.current=e,e.on("hlsManifestParsed",()=>{console.log(`HLS initialized for stream: ${t}`),g(!0),p(null)}),e.on("hlsError",(t,s)=>{if(s.fatal){console.error(`Fatal HLS error: ${s.type} - ${s.details}`),p(`Playback error: ${s.details}`);try{switch(s.type){case"networkError":e.startLoad();break;case"mediaError":e.recoverMediaError();break;default:e.destroy()}}catch(r){console.error("Error recovery failed:",r),e.destroy()}}}),e.loadSource(x),r.current&&e.attachMedia(r.current)}else(null==(s=r.current)?void 0:s.canPlayType("application/vnd.apple.mpegurl"))?(console.log(`Using native HLS for stream: ${t}`),r.current.src=x,g(!0)):p("HLS not supported in this browser")}).catch(()=>{console.error("HLS.js loading failed"),p("Video playback engine missing")}),()=>{i.current&&(i.current.destroy(),i.current=null)}),[x,t]);const b=()=>{r.current&&f&&(d?r.current.pause():r.current.play().catch(()=>{console.error("Playback failed"),p("Failed to start playback")}))},v=()=>{i.current&&(i.current.destroy(),i.current=null),s(t)};if(!y)return j.jsx("div",{className:"aspect-video bg-black/50 rounded-lg flex items-center justify-center",children:j.jsx("p",{className:"text-sky-subtle",children:"Stream not found"})});return j.jsxs("div",{className:"glass-card rounded-xl p-4 hover:shadow-neon-lg transition-all duration-300",children:[j.jsxs("div",{className:"aspect-video bg-black/50 rounded-lg mb-3 relative overflow-hidden neon-border",children:[j.jsx("video",{ref:r,className:"w-full h-full object-cover",muted:!0,playsInline:!0,controls:!1,onPlay:()=>u(!0),onPause:()=>u(!1)}),j.jsx("button",{onClick:v,className:"absolute top-2 left-2 bg-red-600/80 hover:bg-red-600 backdrop-blur-sm rounded-full p-2 transition-all duration-200 z-10",title:"Remove Stream",children:j.jsx(a,{className:"h-4 w-4 text-white"})}),j.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m?j.jsxs("div",{className:"text-center",children:[j.jsx(n,{className:"h-8 w-8 text-red-400 mx-auto mb-2"}),j.jsx("p",{className:"text-red-400 text-sm",children:m})]}):f?j.jsx("button",{onClick:b,className:"bg-black/50 hover:bg-black/70 backdrop-blur-sm rounded-full p-4 transition-all duration-200 opacity-0 hover:opacity-100",children:(()=>{switch(y.status){case"connecting":return j.jsx(o,{className:"h-8 w-8 text-sky-primary animate-spin"});case"error":return j.jsx(n,{className:"h-8 w-8 text-red-400"});case"active":return d?j.jsx(l,{className:"h-8 w-8 text-sky-primary"}):j.jsx(c,{className:"h-8 w-8 text-sky-primary"});default:return j.jsx(c,{className:"h-8 w-8 text-sky-subtle"})}})()}):j.jsxs("div",{className:"text-center",children:[j.jsx(o,{className:"h-8 w-8 text-sky-primary animate-spin mx-auto mb-2"}),j.jsx("p",{className:"text-sky-subtle text-sm",children:"Loading HLS..."})]})}),j.jsx("div",{className:"absolute top-2 right-2 bg-black/70 backdrop-blur-sm rounded px-2 py-1 text-xs text-sky-text",children:m?"Error":f?d?"Playing":"Ready":"Loading"}),m&&j.jsx("div",{className:"absolute bottom-2 left-2 right-2 bg-red-900/80 backdrop-blur-sm rounded px-2 py-1 text-xs text-red-200",children:m})]}),j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{children:[j.jsx("span",{className:"text-sky-text font-medium",children:y.title}),j.jsx("p",{className:"text-sky-subtle text-sm",children:m||(f?"Live stream":"connecting"===y.status?"Connecting to stream...":"Loading...")})]}),j.jsxs("div",{className:"flex space-x-2",children:[j.jsxs("button",{onClick:b,disabled:!f||!!m,className:"bg-sky-primary/20 hover:bg-sky-primary/30 text-sky-primary px-3 py-1 rounded text-sm transition-all duration-200 flex items-center space-x-1 disabled:opacity-50",children:[d?j.jsx(l,{className:"h-3 w-3"}):j.jsx(c,{className:"h-3 w-3"}),j.jsx("span",{children:d?"Pause":"Play"})]}),j.jsxs("button",{onClick:v,className:"bg-red-500/20 hover:bg-red-500/30 text-red-400 px-3 py-1 rounded text-sm transition-all duration-200 flex items-center space-x-1",children:[j.jsx(a,{className:"h-3 w-3"}),j.jsx("span",{children:"Remove"})]})]})]})]})}const R="wss://rtsp-backend-88322650503.us-central1.run.app/ws/stream/";function E(){const[t,s]=e.useState(""),[r,a]=e.useState(null),{isConnected:o,lastMessage:l,addStream:c,removeStream:p}=function(t){const s=e.useRef(null),[r,a]=e.useState(!1),[n,o]=e.useState(null),l=e.useRef(),c=e.useCallback(()=>{try{s.current=new WebSocket(t),s.current.onopen=()=>{console.log("WebSocket connected"),a(!0)},s.current.onmessage=e=>{try{const t=JSON.parse(e.data);o(t)}catch(t){console.error("Failed to parse WebSocket message:",t)}},s.current.onclose=()=>{console.log("WebSocket disconnected"),a(!1),l.current=setTimeout(()=>{console.log("Attempting to reconnect..."),c()},3e3)},s.current.onerror=e=>{console.error("WebSocket error:",e),a(!1)}}catch(e){console.error("Failed to create WebSocket:",e)}},[t]);e.useEffect(()=>(c(),()=>{l.current&&clearTimeout(l.current),s.current&&s.current.close()}),[c]);const i=e.useCallback(e=>{s.current&&s.current.readyState===WebSocket.OPEN?s.current.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message")},[]),d=e.useCallback((e,t)=>{i({action:"add_stream",url:e,title:t||`Stream ${Date.now()}`})},[i]),u=e.useCallback(e=>{i({action:"remove_stream",stream_id:e})},[i]);return{isConnected:r,sendMessage:i,lastMessage:n,addStream:d,removeStream:u}}(R),{addStream:x,updateStreamStatus:h,addStreamChunk:f,setConnectionStatus:g,getActiveStreams:y,removeStream:b}=w();e.useEffect(()=>{g(o?"connected":"disconnected")},[o,g]),e.useEffect(()=>{var e;if(l)switch(l.type){case"connection_established":console.log("WebSocket connected"),a({type:"success",message:"Connected to stream server"});break;case"stream_added":l.stream_id&&l.url&&l.title&&(x(l.stream_id,l.url,l.title),a({type:"success",message:`Stream "${l.title}" added`}),console.log(`Stream added: ${l.stream_id}`));break;case"stream_data":if(l.stream_id&&l.chunk)try{const e=atob(l.chunk),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);f(l.stream_id,t)}catch(t){console.error("Failed to decode stream chunk:",t)}break;case"stream_status":if(l.stream_id){const t=(null==(e=l.message)?void 0:e.includes("error"))?"error":"active";h(l.stream_id,t)}break;case"stream_removed":l.stream_id&&(b(l.stream_id),a({type:"success",message:"Stream removed successfully"}),console.log(`Stream removed: ${l.stream_id}`));break;case"error":console.error("WebSocket error:",l.message),a({type:"error",message:l.message||"Unknown error"});break;default:console.log("Unhandled message type:",l.type)}},[l,x,h,f,b]),e.useEffect(()=>{if(r){const e=setTimeout(()=>a(null),5e3);return()=>clearTimeout(e)}},[r]);const v=()=>{if(t.trim()&&t.startsWith("rtsp://")){const e=`Camera ${y().length+1}`;c(t,e),s("")}else a({type:"error",message:"Please enter a valid RTSP URL starting with rtsp://"})},k=e=>{p(e)},S=y();return j.jsxs("div",{className:"min-h-screen bg-sky-bg",children:[j.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[j.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-sky-primary/5 rounded-full blur-3xl animate-pulse-neon"}),j.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-sky-secondary/5 rounded-full blur-3xl animate-pulse-neon",style:{animationDelay:"1s"}})]}),r&&j.jsx("div",{className:"fixed top-4 right-4 z-50 glass-card p-4 rounded-lg shadow-neon-lg animate-slide-up "+("error"===r.type?"border-red-500/50":"border-green-500/50"),children:j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsx(n,{className:"h-4 w-4 "+("error"===r.type?"text-red-400":"text-green-400")}),j.jsx("span",{className:"text-sky-text text-sm",children:r.message})]})}),j.jsx("div",{className:"relative border-b border-white/10 backdrop-blur-md bg-white/5",children:j.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(i,{className:"h-8 w-8 text-sky-primary animate-pulse-neon"}),j.jsx("h1",{className:"text-2xl font-heading font-bold bg-gradient-to-r from-sky-primary to-sky-secondary bg-clip-text text-transparent",children:"RTSP Viewer"})]}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"flex items-center space-x-2 text-sm text-sky-subtle",children:o?j.jsxs(j.Fragment,{children:[j.jsx(d,{className:"h-4 w-4 text-green-400"}),j.jsx("span",{children:"Connected"})]}):j.jsxs(j.Fragment,{children:[j.jsx(u,{className:"h-4 w-4 text-red-400"}),j.jsx("span",{children:"Disconnected"})]})}),j.jsxs("div",{className:"text-sm text-sky-subtle",children:[S.length," active streams"]})]})]})})}),j.jsxs("div",{className:"relative max-w-7xl mx-auto px-6 py-8",children:[j.jsxs("div",{className:"glass-card rounded-xl p-6 mb-8 animate-fade-in",children:[j.jsx("h2",{className:"text-xl font-semibold mb-4 text-sky-text",children:"Add RTSP Stream"}),j.jsxs("div",{className:"flex space-x-4",children:[j.jsx("input",{type:"text",value:t,onChange:e=>s(e.target.value),placeholder:"rtsp://username:password@ip:port/path",className:"flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-sky-text placeholder-sky-subtle focus:outline-none focus:ring-2 focus:ring-sky-primary focus:border-transparent transition-all",onKeyPress:e=>"Enter"===e.key&&v()}),j.jsxs("button",{onClick:v,disabled:!o,className:"glass-button px-6 py-2 rounded-lg flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[j.jsx(m,{className:"h-4 w-4"}),j.jsx("span",{children:"Add Stream"})]})]})]}),j.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:0===S.length?j.jsxs("div",{className:"col-span-full text-center py-12 animate-fade-in",children:[j.jsx(i,{className:"h-16 w-16 text-sky-subtle mx-auto mb-4 animate-pulse"}),j.jsx("p",{className:"text-sky-subtle text-lg",children:"No streams added yet"}),j.jsx("p",{className:"text-sky-subtle/60",children:"Add your first RTSP stream to get started"})]}):S.map(e=>j.jsx(L,{streamId:e.id,onRemove:k},e.id))})]})]})}console.log("üîç Environment variables:"),console.log("VITE_WS_URL:","wss://rtsp-backend-88322650503.us-central1.run.app/ws/stream/"),console.log("VITE_BACKEND_URL:","https://rtsp-backend-88322650503.us-central1.run.app"),console.log("Using WS_URL:",R),console.log("Using BACKEND_URL:","https://rtsp-backend-88322650503.us-central1.run.app"),S.createRoot(document.getElementById("root")).render(j.jsx(s.StrictMode,{children:j.jsx(E,{})}));
